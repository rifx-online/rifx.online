---
import config from "@/config/config.json";
import {
  getLangFromUrl,
  slugSelector,
} from "@/lib/utils/languageParser";
import { humanize, plainify, slugify } from "@/lib/utils/textConverter";
import { formatNumber, formatTokens } from "@/lib/utils/formatUtils";
import { FaRegUserCircle } from "react-icons/fa";

const { summary_length }: { summary_length: number; model_folder: string } =
  config.settings;
const { data } = Astro.props;
const {
  title,
  id,
  context,
  input,
  output,
  description,
  image,
  categories,
  date,
  author,
  img,
  request,
  discount,
  is_free,
} = data.data;

const lang = getLangFromUrl(Astro.url);

const slugParts = data.slug.split("/");
slugParts[0] = "models";
const modifiedSlug = slugParts.join("/");
data.slug = modifiedSlug;

---

<div class="relative h-full bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-100 dark:border-gray-700 hover:shadow-md transition-shadow duration-200">
  {(discount || is_free) && (
    <div class="badge-container absolute -top-1.5 -right-1.5 z-10">
      {discount < 1 && (
        <span class="badge inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200">
          {discount * 100}%
        </span>
      )}
      {is_free && (
        <span class="badge inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">
          Free
        </span>
      )}
    </div>
  )}
  
  <div class="p-4">
    <div class="mb-4">
      <h3 class="text-xl font-semibold text-gray-600 dark:text-gray-300 line-clamp-1">
        <a href={slugSelector(`/${data.slug}`, lang)} class="hover:text-primary">
          {title}
        </a>
      </h3>
    </div>

    <p class="text-sm text-gray-400 dark:text-gray-400 mb-6 line-clamp-2">
      {plainify(data.body?.slice(0, Number(summary_length)))}...
    </p>

    <div class="text-xs text-gray-400 dark:text-gray-400 flex flex-wrap gap-2 justify-between">
      <span class="flex items-center">
        <FaRegUserCircle className="mr-1" />
        {humanize(author)}
      </span>
      <span class="flex items-center">
        <span class="px-3">{formatNumber(context)}</span>
        <span class="border-l border-gray-200 px-3">${formatTokens(input * 1000000)}</span>
        <span class="border-l border-gray-200 px-3">${formatTokens(output * 1000000)}</span>
      </span>
    </div>
  </div>
</div>

<style>
  .line-clamp-1 {
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* 优化的标签样式和动画 */
  .badge-container {
    transform-origin: center;
    transition: transform 0.2s ease;
  }

  .badge {
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    transition: all 0.2s ease;
  }

  .badge:hover {
    transform: translateY(-1px);
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
  }
</style>
